{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mt-4 mb-5 text-secondary display-4 fw-light">Register a New Pet</h1>

    {% if message %}
    <div class="alert alert-{{ alert_class }} alert-dismissible fade show shadow-sm" role="alert">
        <i class="bi bi-info-circle-fill me-2"></i>
        Status: {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="row justify-content-center">
        <div class="col-lg-10"> <div class="card shadow-lg border-0">
                <div class="card-body p-5">
                    <form method="POST">
                        
                        <fieldset class="mb-5 border p-4 rounded bg-white">
                            <legend class="float-none w-auto px-2 fs-5 text-primary">Basic Information</legend>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="petName" class="form-label fw-bold">Pet Name</label>
                                    <input type="text" id="petName" name="name" class="form-control form-control-lg" placeholder="Enter pet name" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="petAge" class="form-label fw-bold">Age (Years)</label>
                                    <input type="number" id="petAge" name="age" class="form-control" placeholder="Age" min="0" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="petGender" class="form-label fw-bold">Gender</label>
                                    <select id="petGender" name="gender" class="form-select" required>
                                        <option value="">Select Gender</option>
                                        <option value="M">Male</option>
                                        <option value="F">Female</option>
                                        <option value="Unknown">Unknown</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset class="mb-5 border p-4 rounded bg-white">
                            <legend class="float-none w-auto px-2 fs-5 text-primary">Type & Location</legend>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="petTypeSelect" class="form-label fw-bold">Species / Type</label>
                                    <select id="petTypeSelect" name="type_id" class="form-select" required onchange="toggleOtherType(this.value)">
                                        <option value="">Select Type</option>
                                        {% for t in pet_types %}
                                            <option value="{{ t.type_id }}">{{ t.species }} - {{ t.breed }}</option>
                                        {% endfor %}
                                        <option value="other">Other (Specify Below)</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="petShelter" class="form-label fw-bold">Shelter Location</label>
                                    <select id="petShelter" name="shelter_id" class="form-select" required>
                                        <option value="">Select Shelter</option>
                                        {% for s in shelters %}
                                            <option value="{{ s.shelter_id }}">{{ s.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row g-3 mt-3" id="otherTypeContainer" style="display: none;">
                                <div class="col-md-6">
                                    <label for="newSpecies" class="form-label fw-bold text-danger">New Species / Breed</label>
                                    <input type="text" id="newSpecies" name="new_species" class="form-control" placeholder="e.g., Golden Retriever - Standard" disabled>
                                </div>
                            </div>
                            
                        </fieldset>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end pt-3">
                            <button type="submit" class="btn btn-success btn-lg px-5 shadow-sm">
                                <i class="bi bi-plus-circle-fill me-2"></i> Register Pet
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleOtherType(selectedValue) {
        const container = document.getElementById('otherTypeContainer');
        const input = document.getElementById('newSpecies');

        if (selectedValue === 'other') {
            container.style.display = 'flex'; 
            input.disabled = false;
            input.required = true;
        } else {
            container.style.display = 'none';
            input.disabled = true;
            input.required = false;
            input.value = '';
        }
    }
</script>
{% endblock %}